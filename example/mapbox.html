<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Add a vector tile source</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@5.1.6/turf.min.js"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id='map'></div>
<script>
mapboxgl.accessToken = '<your access token here>';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v10',
    zoom: 13,
    center: [-122.447303, 37.753574],
    transformRequest: function(url, resourceType) {
        if (resourceType == 'Tile' && url.startsWith('http://localhost')) {
            return {
              //   url: `${url}?status=free`,
              url: url,
              //   headers: { 'Custom header': 'value' },
              headers: { },
            };
          }
        },
});

map.on('load', function () {
    map.addSource('points', {
          type: 'vector',
          tiles: ['http://localhost:4000/station/{z}/{x}/{y}/tile.mvt'],
        });
        map.addLayer(
          {
            id: 'points',
            type: 'symbol',
            source: 'points',
            'source-layer': `points`,
            filter: ['<', ['get', 'count'], 2],
            interactive: true,
            layout: {
              'icon-image': `icon-image`,
              'text-ignore-placement': true,
              'icon-allow-overlap': true,
            },
          }
        );

        map.addLayer(
          {
            id: 'clusters',
            type: 'symbol',
            source: 'points',
            'source-layer': `points`,
            interactive: true,
            filter: ['>', ['get', 'count'], 1],

            layout: {
              'icon-image': 'cluster',
              'text-field': ['get', 'count'],
              'text-size': 12,

              'icon-anchor': 'center',
              'icon-allow-overlap': true,
              'text-allow-overlap': true,
              'text-ignore-placement': true,
            },
            paint: {
              'text-color': '#ffffff',
            },
          }
        );
        map.on('click', function(e) {
          var features = map.queryRenderedFeatures(e.point, {
            layers: ['clusters', 'points'],
          });
          if (
            features.length > 0 &&
            !!features[0].properties &&
            !!features[0].properties.bbox
          ) {
              var bbox = JSON.parse(features[0].properties.bbox);
              var bounds = turf.bbox(bbox);
              map.fitBounds(bounds, {
                        padding: 100
                    });            
            }
        });
      });        
});
</script>

</body>
</html>